!function(a,b){function c(c,d){return this.$zoom=a(c),this.opts=a.extend({},j,d),this.open===b&&this.__init(),this}var d,e,f,g,h,i,j={width:480,height:640,top:0,left:500,loading:"Loading."};c.prototype.__init=function(){var b=this;this.$target=this.$zoom.find(".easyzoom-target"),this.$image=this.$target.children("img"),this.$gallery=this.$zoom.find(".easyzoom-gallery"),this.$flyout=a('<div class="easyzoom-flyout" />'),this.$loading=a('<p class="easyzoom-loading">'+this.opts.loading+"</p>"),this.$zoom.css("position","relative"),this.$flyout.css({position:"absolute",top:this.opts.top,left:this.opts.left,width:this.opts.width,height:this.opts.height,overflow:"hidden"}),this.__loadFlyout(this.$target.attr("href")),this.$target.css({position:"relative",display:"inline-block"}).on("mouseenter touchstart",function(a){a.originalEvent.touches&&1!==a.originalEvent.touches.length||(a.preventDefault(),b.show(a))}).on("mousemove touchmove",function(a){b.open&&(a.preventDefault(),b.__move(a))}).on("mouseleave touchend",function(){b.open&&b.hide()})},c.prototype.__loadFlyout=function(a){var b=this,c=this.__loadImage(a);this.loaded=!1,this.$target.css("cursor","progress").addClass("is-loading").append(this.$loading),c.on("error",function(){b.$loading.detach(),b.$target.css("cursor","auto")}),c.on("load",function(){b.loaded=!0,b.$loading.detach(),b.$target.removeClass("is-loading").css("cursor","crosshair"),b.$flyout.html(c.css("position","absolute"))}),this.$imageZoomed=c},c.prototype.show=function(a){var b,c,h,i;!this.$flyout.parent().length&&this.loaded&&(this.open=!0,this.$flyout.appendTo(this.$zoom),b=this.$image.width(),c=this.$image.height(),h=this.$flyout.width(),i=this.$flyout.height(),d=this.$imageZoomed.width()-h,e=this.$imageZoomed.height()-i,f=d/b,g=e/c,this.__move(a))},c.prototype.hide=function(){this.$flyout.parent().length&&(this.$flyout.detach(),this.open=!1)},c.prototype.__move=function(a){0===a.type.indexOf("touch")?(h=a.originalEvent.touches[0].pageX,i=a.originalEvent.touches[0].pageY):(h=a.pageX||h,i=a.pageY||i);var b=this.$image.offset(),c=h-b.left,j=i-b.top,k=c*f,l=j*g;k=k>d?d:k,l=l>e?e:l,k>0&&l>0&&this.$imageZoomed.css({left:-k,top:-l})},c.prototype.__loadImage=function(b){var c=new Image;return c.src=b,a(c)},c.prototype.update=function(a){this.hide(),this.__preloadPanel(a)},c.prototype.gallery=function(b,c){var d=this,e=c?a(c):this.e.parent;e.on("click",b,function(b){b.preventDefault();var c=a(this).addClass("is-loading"),e=c.attr("href"),f=c.data("easyzoomSource");d.__loadImage(f).on("load",function(){d.e.source.attr("src",f),d.e.target.attr("href",e),d.update(e),c.removeClass("is-loading")})})},a.fn.easyZoom=function(b){return this.each(function(){a.data(this,"easyZoom")||a.data(this,"easyZoom",new c(this,b))})},"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof module&&module.exports&&(module.exports=c)}(jQuery);